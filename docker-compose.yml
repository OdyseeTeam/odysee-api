version: "3.2"

services:
  lbrynet:
    image: odyseeteam/lbrynet-tv:0.101.2
    container_name: lbrynet
    ports:
      - "5581:5279"
      - "5279:5279"
    volumes:
      - storage:/storage
    environment:
      SDK_CONFIG: /daemon/daemon_settings.yml
    labels:
      com.centurylinklabs.watchtower.enable: true
  app:
    image: odyseeteam/odysee-api:latest
    ports:
      - 8080:8080
    volumes:
      - storage:/storage
    environment:
      LW_DEBUG: 1
    depends_on:
      - lbrynet
      - postgres
    labels:
      com.centurylinklabs.watchtower.enable: true
  redis:
    image: redis:7
    container_name: redis
    ports:
      - '6379:6379'
    volumes:
      - redis-data:/data
    command: >
      --requirepass odyredis --appendonly yes
    labels:
      com.centurylinklabs.watchtower.enable: false
    restart: unless-stopped
  postgres:
    image: postgres:11-alpine
    command:
      - -clogging_collector=on
      - -clog_statement=all
      - -clog_destination=stderr
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/pgdata
    environment:
      POSTGRES_USER: lbrytv
      POSTGRES_PASSWORD: lbrytv
      PGDATA: /pgdata
      TZ: "UTC"
      PGTZ: "UTC"

volumes:
  pgdata: {}
  storage: {}
  redis-data: {}
